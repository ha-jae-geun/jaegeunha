# 인코딩
```java
웹 컨테이너가 JSP페이지를 읽어올 때 사용할 케릭터 셋을 결정하는 기본 과정

1)기본 인코딩을 파일을 읽은 후, pageEncoding을 찾는다.

2)pageEncoding을 찾으면 해당 속성을 사용하고, 없으면 contentType을 검색한다.

3)contentType을 찾으면 해당 속성의 charset을 사용한다.

4)모두 해당되지 않는경우 ISO-8859-1 을 사용한다.

#)단, (1)번 과 (3)번의 경우 대상을 찾기 이전에 ASCII문자 이외의 글자가 포함되어 있지 않은 경우에 한해 적용된다.

 

JSP페이지를 구현할때는 "EUC-KR"을, 응답결과는 "UTF-8"로 하고싶다면?

<%@ page contentType="text/html; charset=utf-8" %>

<%@ page pageEncoding="euc-kr" %>



출처: https://unabated.tistory.com/entry/JSP-pageEncoding속성-케릭터셋charset [랄라라]
```

# contentType
```java
* contentType 인코딩 타입


위의 pageEncoding 설정이 정상적이어서 정상적인 서블릿 파일이 생성되었다고 한다면, 
이 서블릿 파일은 클라이언트(브라우저)에게 html 등의 코드와 문자열을 전송해줘야 합니다. 

이 때 데이터를 전송하기 위해 해당 코드와 문자열을 인코딩하는 타입을 지정해주는 부분이 contentType 입니다. 
해당 인코딩 타입으로 데이터를 보내면서 http 프로토콜의 헤더에 이 타입을 명시에 주는데 
브라우저에서는 이 타입으로 데이터를 디코딩해서 브라우저에 출력해주게 됩니다. 

 

HTML 코드 안에 보면 <meta> 태그에도 인코딩 타입이 또 있는데, 만약 헤더에 contentType으로 인코딩 타입이 지정돼 있다면 
<meta> 태그에서 지정된 인코딩 타입은 그냥 무시합니다. <meta> 태그의 인코딩 타입은 헤더에 타입이 명시돼 있지 않은 경우에 브라우저가 참조하는 타입입니다. 

 

아래와 같이 JSP에서 <meta> 태그의 인코딩 타입을 아무거나 넣고 가동해도 정상적으로 브라우저에서 한글이 출력되는 것을 확인할 수 있습니다. 
헤더의 contentType으로 인코딩 타입이 명시되어 있기 때문에 무시하는 것입니다
```

# pageEncoding
```java
* pageEncoding 인코딩 타입


아래 코드에서 아랫줄에 있는 인코딩 타입입니다. pageEncoding의 인코딩 타입은 위에서 말한대로 자기 자신을 어떤 타입으로 인코딩해서 저장할지, 
그리고 누군가 읽어들일때도 어떤 타입으로 디코딩해서 읽을지를 지정해주는 설정입니다. 이클립스에서 저장할 때나 읽어들일 때도 
pageEncoding 타입을 확인해 인코딩해 저장하고 디코딩해 출력합니다. 또한 JVM에서 JSP를 처음 로드하기 위해 파일을 읽어들일 때도 해당 타입을 확인한 뒤 읽어들입니다. 

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
 

코드를 읽어서 파일을 저장하고 읽을 인코딩 타입을 확인하기 때문에, 이클립스 같이 코드를 해석할 수 있는 IDE에서 생성하고 
열 때는 문제가 생기지 않습니다. 남들이 어떤 타입으로 지정해뒀건 이클립스가 읽을 때 해당 타입으로 디코딩해서 출력해주기 때문입니다.
하지만 메모장 같이 일반 텍스트 파일로 만들어서 사용할 때는 이 코드를 주의해서 사용해야 합니다.

예를 들어 메모장 파일에서 JSP파일을 만들어 저장할 때 "ANSI" 타입으로 인코딩해보겠습니다. 대신 코드의 pageEncoding는 "UTF-8"로 설정합니다. 
이 의미는 "텍스트의 내용을 ANSI코드로 변환해서 저장한다. 하지만 코드 내에서 "나는 UTF-8로 인코딩 돼있는 파일이다!" 라고 말하고 있다" 
라는 의미입니다. 코드를 확인해서 저장 방식을 결정하는 IDE와 달리 메모장은 그냥 설정한대로 저장하고 코드는 그저 의미 없는 문자로 인식하기 때문입니다. 

그리고 이렇게 생성된 JSP 파일을 이클립스에서 열어봅니다. 여지 없이 한글이 깨져나옵니다. 이유는 이클립스가 파일을 열면서 코드를 보니 
"얘는 UTF-8로 인코딩된 파일이구나" 라고 확인했기 때문에 UTF-8 타입으로 디코딩해 출력해주기 때문입니다. A를 '100'으로 변환해 저장한 
파일을 읽을 때 100을 '?!'이라는 문자로 변환해주니 한글이 깨지는 것이라고 할 수 있습니다.


톰캣의 컨테이너가 JSP 파일을 로드할 때도 해당 코드에 설정된 인코딩 타입을 참조합니다. JVM은 코드를 읽어오면 문자열을 유니코드로 
변환해서 가져오는데 이 때 해당 타입으로 디코딩해서 유니코드로 변환시켜 가져옵니다. 역시 위와 같이 메모장에서 설정을 맞춰주지 않았다면 
변환된 서블릿 파일(.java 파일)의 한글 문자도 깨지게 되며 결과적으로 이걸 다시 웹으로 출력해줄 때도 인코딩 타입이 꼬여있기 때문에 
이상한 문자열이 출력됩니다. 간단히 이클립스에서 JSP 파일을 열었는데 한글이 깨져서 나오면 뭔가 파일 자체의 인코딩 타입과 
pageEncoding에 설정된 타입이 맞지 않는구나 생각하면 됩니다.
```

# [인코딩 타입](https://codevang.tistory.com/196)
```java
* 인코딩 타입이 지정되어 있지 않을 경우

[ IDE / Tomcat에서 처리]

PageEncoding이 없을 경우 : contentType의 charset을 참조함
contentType의 charset도 없을 경우 : 시스템 디폴트 설정을 참조함
 

[ 브라우저에서 처리]

 PageEncoding은 클라이언트(브라우저)와 상관없음
 contentType의 charset이 없을 경우 : <meta> 태그의 charset 참조
 <meta> 태그의 charset도 없을 경우 : 브라우저 디폴트 설정을 참조함

```
