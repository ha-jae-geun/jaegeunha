# 문제
```java
82. IPv4에서 IPv6로의 천이 전략 중 캡슐화 및 역캡슐화를 사용 하는 것은?  4번
① Dual Stack ② Header translation
③ Map Address ④ Tunneling
```

# [네트워크 계층](https://www.youtube.com/watch?v=s5kIGnaNFvM&list=PL0d8NnikouEWcF1jJueLdjRIC4HsUlULi&index=3)
- 시스템간 연결성과 경로 선택을 제공하는 역할을 하는 계층입니다. IP address 를 이용하여 라우팅 프로토콜이 연결된 네트워크를 통한 최적경로를 선택합니다.
* 서로 다른 네트워크 대역(LAN 과 LAN)

```java
Logical Address(IP, IPX)를 담당한다.

패킷의 이동경로를 결정하는 계층이다.

3계층의 단위 : Packet

경로선택, 라우팅, 논리적인주소(IP)를 정의하는 계층이다.

Routing Protocol을 이용하여 최적경로를 선택한다.

대표적인 프로토콜로는 VPN을 구성하는데 사용되는 IPSec가 있다.

3계층 장비 : Router
```

# IP
* ㆍIP 는 에 대한 주소를 가진다 IP  주소는 네트워크에서 장치들이 서로를 인식하고 통신을 하기 위해서 사용하는 특수한 번호이다 IP . 네트워크에 연결된 장치는 모든 기계는 를 가지고 있어야 한다 
* 네트워크 구조를 유지시키는 역할  
    ^to stay the network structure
* IP 부여 -> 내가 원하는 곳으로 루트 선정  
    * Give ip address > set route to node that i want
    * 1988년 IANA; Internet Assigned Numbers Authority; 현재 ICANN(미국 LA)이 요청에 따라 APNIC에게 나눠줌 ->  한국의 국가기관(KRNIC)에서 발급 -> SK/KT/LG -> 가정집에 1개 부여 -> 공유기에 따라 분배(외부에서 안보이는 나만 보이는; 192.168.0. 가상 IP; 밖에서 봤을 땐 하나의 IP)
      * 대륙마다 기관이 다름: APNIC(호주에 위치; 한국 포함), RIPE(NCC), AFRINIC(아프리카), LACNIC(남미), ARIN(북미)
      * 홈페이지: KRNIC 홈페이지에서 확인 가능

## IP 형태
* 고정 IP: 고정 는 컴퓨터에 고정적으로 부여된 로 한번 부여되면 를 반납하기 전까지는 다른 장비에 IP IP IP 부여할 수 없다. 고정 는 일반 전화기라고 생각하면 된다 IP . 
* 유동 IP: 유동 는 장비에 고정적으로 를 부여하지 않고 컴퓨터를 사용할 때 남아 있는 중에서 IP IP IP 돌아가면서 부여한다. 유동 는 공중 전화기라고 생가하면 된다 IP . 
* 사설 IP:  사설 는 사용자가 임의로 부여한다 IP . 사설 는 내부적으로 인터넷 환경처럼 사용할 수 있지만 인터넷 상에서 서로 연결되지 않도록 IP 되어 있다. 사설 는 내부 전화기라고 생각하면 된다 IP .

## 내 IP 확인 방법
* 구글에서 MY IP 검색

## IP Tracker
* 추적 가능: 도시, 동 + 대략적 위치 좌표, 인터넷 가입 회사, 인터넷 속도, 인터넷 브라우저, 시간

### IP
* IP주소 알면 도시, 동까지는 알 수 있다.

```java
3계층에서 가장 중요한 프로토콜은 IP

IP는 전송 계층(4계층)으로부터 받은 데이터(세그먼트)에 IP 헤더를 붙여 패킷으로 만든다.

IP 헤더는 패킷의 목적지를 나타내는 택배 전표와 같다

IP는 IP 주소라는 32비트로 된 식별번호를 사용하여 컴퓨터를 식별한다.

192.168.1.1
8비트마다 .으로 구분하여 10진수로 표기, 점으로 구분된 그룹을 옥텟이라 하며 맨 처음부터 1옥텟, 2옥텟이라 부른다.

IP 주소는 단독으로 사용하는 것이 아니라 서브넷 마스크라는 32비트로 된 값과 세트로 사용

IP 주소는 서브넷 마스크로 분할된 네트워크부와 호스트부로 구성

네트워크부는 네트워크 자체 호스트부는 해당 네트워크에 연결되어 있는 단말을 나타냄

서브넷 마스크는 이 둘을 구분하는 표식과 같은 것으로,
1 : 네트워크부 / 0 : 호스트부

서브넷 마스크에는 10진수 표기와 CIDR 표기라는 2종류 표기 방법이 존재

10진수 표기는 IP 주소와 마찬가지로 32비트를 8비트씩 4개 그룹으로 나눈 후 각각을 10진수로 변환하여 점으로 구분

CIDR 표기는 IP 주소 다음에 슬래시와 ‘1’의 개수를 추가하여 표기
```

## 여러 가지 IP 주소
```java
사용 용도나 사용 장소에 따라 어디까지 어떻게 사용해야 하는지가 정해져 있다.

A ~ E 클래스까지 5개의 주소 클래스로 나눌 수 있다.

주소 클래스는 IP 주소의 32비트 중 처음 1~4비트로 분류
즉 맨 처음 비트에 따라 사용할 수 있는 IP 주소의 범위가 정해짐

일반적으로 A ~ C 클래스 사용
차이점은 네트워크 규격의 차이이다.

A -> B -> C 순서로 규격이 작아진다.

D와 E는 특수한 용도로 사용하므로 일반적으로는 사용 X

IP 주소에는 호스트부가 모두 0인 네트워크 주소
혹은 모두 1인 브로드캐스트 주소등 컴퓨터에 설정할 수 없는 것도 존재한다.

사용 장소에 따른 분류
IP 주소는 사용 장소에 따라
글로벌 IP 주소 / 프라이빗 IP 주소로 분류

글로벌 IP 주소는 인터넷에서 고유한 IP 주소

프라이빗 IP 주소는 조직이나 가정 등의 LAN에서 자유롭게 할당해도 좋은 IP 주소

Class A --> 10.0.0.0 ~ 10.255.255.255

Class B --> 172.168.0.0 ~ 172.31.255.255

Class C --> 192.168.0.0 ~ 192.168.255.255

A 클래스(1칸 띄우기)
0  00000 부터    0  11111
* A 클래스는 0에서 127까지 128개의 대역으로 나눠지고 하나의 대역 당 16777216개의 PC를 가질 수 있다.
 * 네트워크 대역은 적어도 엄청난 pc를 밑에 둘 수 있다.

B 클래스
* 두 번째 숫자까지 네트워크 대역
10 나머지 0 ~ 나머지 1
* 128.0  ~ 191.255는 네트워크 대역 구분, 나머지는 PC 
 * 많은 네트워크 대역, 

C 클래스
110 나머지 0 ~ 나머지 1
 * 192.0.0 ~ 191.255.255 까지 네트워크 대역으로 엄청 많지만 PC가 0~255까지 256개만 관리

D 클래스
1110 나머지 0 ~ 나머지 1
 * 멀티캐스트용 주소

E 클래스
1111 나머지 0 ~ 나머지 1
 * IP 실험용 클래스
 

# 첫 번째 IP 역사의 변화
필드 단위로 구분했던 낭비가 많은 클래스 대신
낭비되지 않도록 아껴쓰는 Classless IP 주소를 사용하자(서브넷 마스크로 네트워크 대역을 구분)


# 서브넷 마스크
* 이진수로 표기했을 때 1로 시작, 1과 1 사이에는 0이 올 수 없다.
255.255.255.192 -> 11111111 11111111 11111111 11000000
 * 000000의 숫자 만큼의 Pc를 관리할 수 있음
 
 
 # 두 번쨰 ip 역사의 변화
1. 사설 IP 대역
* 같은 네트워크 대역에서 사용할 때 사용하는 IP

2. 공인 IP
* 인터넷 세상(다른 네트워크 통신망과 주고 받을 때 사용)
* 일반적으로 공유기는 공인 IP를 사용한다.(외부에서 사설 IP로 먼저 정보를 요청했을 때 공유기에서 받고 전달하지 않음)
* 공인 IP 하나 당 2의 32개의 사설 IP를 사용할 수 있다.

# NAT
* 네트워크 주소를 사설 ip에서 공인 IP로 바꿔주는 것
* 실제 NAT 기술은 IP를 바꾸는 기술; 
 * 사설에서 사설 바꾸는 것도 NAT, 공인에서 공인도 NAT
* 외부 네트워크 대역에서는 사설 IP 대역이 보이지 않는다.

# 포트포워딩
* 4계층

# 세 번쨰 ip 역사의 변화
* IPv6(16바이트)

* 터널링
 * IPv4에서 IPv6로 넘어가게 해주는 기술
 
 
 # 특수한 IP 주소
 * 0.0.0.0
  * 와일드 카드: 나머지 모든 IP
 
 * 127.0.0.1
  * 127로 시작하는 주소는 자기 자신을 말하는 주소
  * 네트워크 안될 때 127 -> 공유기 핑 -> 인터넷 핑
 
 * 게이트웨이 주소
  * 공유기의 IP를 주소 설정(WAN: 공인 IP 할당)
  * 주로 가장 큰 주소나 작은 주소로 사용하기로 약속
```

## IP 프로토콜
## IPv4
* 네트워크 상에서 데이터를 교환하기 위한 프로토콜
* 데이터가 정확하게 전달될 것을 보장하지 않는다
* 중복된 패킷을 전달하거나 패킷의 순서를 잘못 전달할 가능성도 있다(악의적으로 이용하면 DOS 공격이 됨)
* 데이터의 정확하고 선차적인 전달은 그보다 상위 프로토콜인 TCP에서 보장한다

### ## IPv4 구조
* 20바이트 + IP Option; 사실 상 20 바이트
* 버전(4비트) + 헤더 길이(4비트) + TOS(1) + Total Length(2) + identification(2) + ID Flags(3비트) + Fragment Offset(13비트)+ 
+ Time To Live(1) + Protocol(1) + Header Checksum(2) + 출발지(4바이트) + 목적지(4바이트)

#### 헤더길이
* 4비트에 쓰기 위해 값/4로 사용

####  ID Flags
* 최대 전송단위보다 크게 보내면 1로 설정되어 상대방에게 뒤의 값이 더 있다고 알려주는 것

#### Fragment Offset(13비트)
* 데이터 순서를 알기 위해 Offset으로 알려 주는 것
* Offset은 기준을 의미; 기준에서 얼마나 떨어져 있는지

#### Time To Live(1)
* 패킷을 살아있을 수 있는 시간
* 운영체제마다 설정값이 달라서 TTL을 이용해서 운영체제를 알아낼 수 있다.

#### Protocol
* 상위 프로토콜 타입을(TCP/UDP) 알려줌

#### Header CHecksum


## IPV4의 조각화
* [따라학습](https://www.youtube.com/watch?v=QKEL9aBgHtg&list=PL0d8NnikouEWcF1jJueLdjRIC4HsUlULi&index=13&t=0s)
* 큰 ip패킷들이 적은 MTU(Maximum Transmission Unit)를 갖는 링크를 통항 전송되려면 여러 개의 작은 패킷으로 쪼개어 전송되어야 한다
* 즉, 목적지까지 패킷을 전달하는 과정에 통과하는 각 라우터마다 저송에 적합한 프레임으로 변환이 필요하다.
* 일단 조각화되면, 최종 목적지에 도달할 때까지 재조립되지 않는 것이 일반적이다.
* IPv4에서는 발신지 뿐만 아니라 중간 라우터에서도 IP 조각화가 가능
* IPv6에서는 IP단편화가 발신지에서만 가능
* 재조립은 항상 최종 수신지에서만 가능
* 패킷이 분리되어도 identification은 동일하다

### MTU
*  MTU란 TCP/IP 네트워크 등과 같은 패킷 또는 프레임 기반의 네트워크에서 전송될 수 있는 최대 크기의 패킷 또는 프레임을 말한다. 한번에 전송할 수 있는 최대 전송량(Byte)인 MTU 값은 매체에 따라 달라진다

### 첫 번재 패킷의 데이터 크기
* MTU - 20(ipv4 헤더)

### 마지막 패킷의 데이터 크기
* 보내려는 데이터 크기 - (MTU -20) * x

## ICMP 프로토콜
* 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류 메시지를 전송 받는 데 주로 쓰인다.
* 프로토콜 구조의 타입과 코드를 통해 오류 메시지를 전송 받는다.
* 특정 대상과 내가 통신이 잘 되는지 확인하는 프로토콜

### ICMP 구조
* 타입(1) + 코드(1) + 체크섬(2) + 기타 다른 정보(4)

### ARP 프로토콜
* 같은 네트워크 대역에서 통신을 하기 위해 필요한 MAc 주소를 IP주소를 이용해서 알아오는 프로토콜
 * IP주소는 알고 MAC 주소는 모르더라도 ARP를 통해 통신이 가능하다
 * 보안에서 중요하다; ARP 스푸핑
* ip주소 -> mAC주소; <> MAC 주소 -> IP 주소: RARP
```java
MAC 주소는 컴퓨터의 NIC(Network Interface Card)에 새겨져 있는 물리적 주소

NIC란 컴퓨터를 네트워크에 연결하기 위해 꼭 필요한 확장 보드이다.

NIC에는 LAN 케이블을 연결하기 위한 잭이 마련되어 있으며,
컴퓨터의 데이터를 전기적인 신호로 변환하여 이 잭으로 송출한다.
받는 수신도 여기서 일어나며, 그 경에우는 수신한 전자 신호를 원래 데이터로 복원하여 컴퓨터에게 전달한다.

IP 주소는 OS에서 설정하는 논리적 주소

두 주소는 서로 협조하면서 사용

이 두 주소를 협조하면서 이용할 수 있도록
물리와 논리의 다리 역할을 하고 있는 것이 ARP(Address Resolution Protocol)

실질적으로 IP 주소와 MAC 주소를 대응시키는 일을 한다.
```

## 프로토콜 구조
```java
하드웨어 타입(2바이트): 이더넷만
프로토콜 타입(3바이트): IPv4 
하드웨어 타입 길이(1): 6(맥주소)
프로토콜 주소 길이(1): 4(IP주소)
OPcode(2): 맥 주소 요청(1), 응답(2)
나머지 주소
```

# [ARP 프로토콜](https://www.youtube.com/watch?v=LDsp-Xb168E&list=PL0d8NnikouEWcF1jJueLdjRIC4HsUlULi&index=4)
* A가 C에게 맥 주소를 묻는다고 가정할 때 (이더넷 프로토콜 + ARP 요청)으로 보냄
 * 이 때 목적지 맥주소는 00 00 00 00 00으로 비워놓음;(2진수)  이더넷 프로콜은 FF FF FF FF로 채움(16진수니까)
  * 모두 F로 채우면 브로드캐스트 주소가 된다. 즉 같은 네트워크 대역의 모두에게 메세지를 모낸 것이다
 * 받은 pc들은 우선 이더넷 프로토콜은 열어서 받는 주소를 본다(브로드캐스트이니 맞다)
 * 그 다음 3계층 ARP 프로토콜을 열고 본인 IP주소가 맞지 않으면 패킷을 버린다
 * 맞는 IP PC는 응답 프로토콜을 만들고 본인 맥주소를 채워 보낸다(이더넷 프로토콜 + ARP 응답)

## ARP 캐시ㅣ 테이블
* 최근에 나와 통신했던 컴퓨터들의 주소는 ARP 테이블에 남는다.
* CMD에서 'arp-a' 명령어 입력

### ARP의 처리 흐름
```java
데이터를 송신하는 컴퓨터가 제 3계층으로부터 패킷을 받으면 패킷의 목적지 IP 주소를 본다.

그것이 동일한 네트워크에 있는 컴퓨터의 것이라면
그 IP 주소를 ARP에서 조회하여 응답 결과를 ARP 테이블이라는 메모리상의 테이블에 등록 후
그 정보를 바탕으로 프레임을 만든다.

만약 다른 네트워크에 있는 컴퓨터의 것이라면
기본 게이트웨이의 MAC 주소를 ARP에서 조회하여 똑같은 처리를 수행한다.

기본 게이트웨이란 자신 이외의 네트워크로 갈 때 사용하는 출구가 되는 IP주소로,
방화벽이나 라우터의 IP 주소가 기본 게이트웨이가 되는 경우가 많다.

자신이 모르는 네트워크의 목적지 IP 주소로 가는 패킷인 경우는 일단 기본 게이트 웨이의 MAC 주소로 송신한다.
```
## [ARP 프로토콜 실습](https://www.youtube.com/watch?v=-M_S50Ga384&list=PL0d8NnikouEWcF1jJueLdjRIC4HsUlULi&index=5)

## 라우팅 테이블
* 라우팅 테이블에 다른 네트워크 대역이 있어야 통신할 수 있다.
* cmd에서 netstat -r

## netstat -r
* 라우팅 테이블, 포트번호, 네트워크 상태 확인 가능
