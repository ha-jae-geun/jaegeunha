# NTP Server
```java
폐쇄망에서 시간 동기화가 하고싶다
이 포스트를 쓰게 된 배경에는 폐쇄망에 존재하는 PC들 사이에 시간을 동기화 하고 싶은 요구가 있었다.

스마트 팩토리를 지향하는 제조사에서 생산 장비에서 발생하는 데이터를 수집, 분석하는 요구가 많다.

이 데이터들을 수집, 분석하는데에 주요한 요소 중 하나가 데이터를 얻은 시간인데 이 장비들은 또 각각의 시스템 시간을 갖고 있어서 

동기화를 해야하는 필요가 있다.

그러나 데이터 유출로 인한 피해가 예상되어 삼엄한 보안 관리(폐쇄망, 하드웨어/저장장치 등 반출 안됨, ...)를 적용하는게 대부분이라

인터넷에 있는 시간으로 동기화할 수 없는 문제가 있다.

이럴 때 시간 동기화 처리를 위한 방법으로 NTP서버를 만드는 것이 있다.

NTP란?

Network Time Protocol(NTP)은 네트워크로 연결되어 있는 컴퓨터들 간에 시간을 동기화하는데 사용하는 프로토콜이다.

NTP의 구조를 간단하게 설명하면 NTP서버, 즉 시간을 동기화를 제공하는 서버는 UDP의 "123" 포트에 NTP서버를 띄워놔야한다.

(기본적으로 NTP는 UDP 123번 포트를 쓴다. 마치 HTTP 80번 포트가 Web의 기본 포트 인 것과 같은 개념이라고 보면 된다.)

NTP 서버의 시간이 NTP 클라이언트들이 정확한 시간이라고 생각하고 동기화하는 기준 시간이라는 것을 인지해야한다.

NTP 클라이언트들은 NTP 서버가 있는 PC의 UDP 123번 포트로 동기화에 이용할 기준 시간을 요청하고 해당 시간으로 자신PC의 

시스템 시간을 동기화한다.


위 그림에서 "192.168.0.2"라는 IP를 할당받은 PC가 NTP서버라면 같은 인터넷 망에 있는 다른 PC들은 해당 서버로 시간 동기화 요청을 할 수 있다.

폐쇄망이 아닌 일반적인 인터넷 상황에서는 NTP(아래 참조)서버를 따로 구축할 필요가 없다.

왜냐하면 국제적으로 표준 시간을 정확히 계산하고 동기화하기 위해 NTP서버를 이미 구축해서 관리하고 있기에, 그 해당 NTP서버에 

시간을 요청해서 동기화하기만 하면 되기 때문이다. (클라이언트 역할로 이용만 하면 된다!)

NTP 서버 리스트(국내에서 쓸만한)는 아래에서 참고하도록 하자.

1.kr.pool.ntp.org
1.asia.pool.ntp.org
time.kriss.re.kr
time.google.com
기타...
위의 NTP서버를 이용해서 시간동기화를 마치면 우리가 좋아하는(?) 네이버 시계의 시간과 내 PC 시스템 시간이 정확히 일치하게되는 

것을 볼 수 있을 것이다.

NTP Client에서 NTP Service의 IP(or domain)를 설정하고 시간을 맞춰보는 건 아래에서 해볼 예정이다.

다시 배경으로 돌아와서 폐쇄망에서는 앞서 말한 글로벌한 NTP Server를 이용할 수 없으므로, 폐쇄망 안에서 시간 동기화를 시키려면

NTP Server를 별도로 구축해야한다. (말이 구축이지 사실 간단한 설정)

윈도우10 NTP Server 만드는 방법
1) NTP Server 기능 ON

2) 방화벽 인바운드 설정 (UDP 123포트 연결 허용)

3) w32time 서비스 자동화

- NTPServer 기능 ON

→ 실행창(단축키 : window키 + R)을 키고 "regedit"입력하면 레지스트리 편집창이 뜬다.
```
